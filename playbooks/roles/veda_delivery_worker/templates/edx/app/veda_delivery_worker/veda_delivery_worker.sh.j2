#!/usr/bin/env bash

# {{ ansible_managed }}

{% set veda_delivery_worker_venv_bin = veda_delivery_worker_home + '/venvs/' + veda_delivery_worker_service_name + '/bin' %}
{% if COMMON_ENABLE_NEWRELIC_APP %}
{% set executable = veda_delivery_worker_venv_bin + '/newrelic-admin run-program ' + veda_delivery_worker_venv_bin + '/python' %}
{% else %}
{% set executable = veda_delivery_worker_venv_bin + '/python' %}
{% endif %}

{% if COMMON_ENABLE_NEWRELIC_APP %}
export NEW_RELIC_APP_NAME='{{ VEDA_DELIVERY_WORKER_NEWRELIC_APPNAME }}'
export NEW_RELIC_LICENSE_KEY='{{ NEWRELIC_LICENSE_KEY }}'
{% endif -%}

source {{ veda_delivery_worker_home }}/{{ veda_delivery_worker_service_name }}_env
{{ executable }} {{ veda_delivery_worker_home }}/{{ veda_delivery_worker_service_name }}/bin/deliver
